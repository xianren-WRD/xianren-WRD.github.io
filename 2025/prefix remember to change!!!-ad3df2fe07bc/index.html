<!DOCTYPE html><html lang="zh-CN"><head><meta charset="utf-8"><meta name="keywords" content="代码,博客,折腾,汽车电子"><meta name="description" content="分享嵌入式系统与CAN总线开发相关知识"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"><title>IIC介绍 | 仙人</title><meta name="generator" content="hexo-theme-ayer"><link rel="shortcut icon" href="/favicon.ico"><link rel="stylesheet" href="/dist/main.css"><link rel="stylesheet" href="/css/fonts/remixicon.css"><link rel="stylesheet" href="/css/custom.css"><script src="https://cdn.staticfile.org/pace/1.2.4/pace.min.js"></script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@sweetalert2/theme-bulma@5.0.1/bulma.min.css"><script src="https://cdn.jsdelivr.net/npm/sweetalert2@11.0.19/dist/sweetalert2.min.js"></script><style>.swal2-styled.swal2-confirm{font-size:1.6rem}</style><link rel="alternate" href="/atom.xml" title="仙人" type="application/atom+xml"></head></html><body><div id="app"><canvas width="1777" height="841" style="position:fixed;left:0;top:0;z-index:99999;pointer-events:none"></canvas><main class="content on"><section class="outer"><article id="post-IIC介绍" class="article article-type-post" itemscope itemprop="blogPost" data-scroll-reveal><div class="article-inner"><header class="article-header"><h1 class="article-title sea-center" style="border-left:0" itemprop="name">IIC介绍</h1></header><div class="article-meta"><a href="/2025/prefix%20remember%20to%20change!!!-ad3df2fe07bc/" class="article-date"><time datetime="2025-10-25T15:21:15.000Z" itemprop="datePublished">2025-10-25</time></a><div class="article-category"><a class="article-category-link" href="/categories/%E6%9D%BF%E7%BA%A7%E9%80%9A%E4%BF%A1%E5%8D%8F%E8%AE%AE/">板级通信协议</a></div><div class="word_count"><span class="post-time"><span class="post-meta-item-icon"><i class="ri-quill-pen-line"></i> <span class="post-meta-item-text">字数统计:</span> <span class="post-count">5.3k</span> </span></span><span class="post-time">&nbsp; | &nbsp; <span class="post-meta-item-icon"><i class="ri-book-open-line"></i> <span class="post-meta-item-text">阅读时长≈</span> <span class="post-count">21 分钟</span></span></span></div></div><div class="tocbot"></div><div class="article-entry" itemprop="articleBody"><h1 id="什么是IIC"><a href="#什么是IIC" class="headerlink" title="什么是IIC"></a>什么是IIC</h1><p>I2C(IIC,Inter－Integrated Circuit)，<strong>两线式串行通信总线</strong>，其实是IICBus简称，所以中文应该叫<strong>集成电路总线</strong>，它是一种串行通信总线，使用多主从架构。由PHILIPS公司开发用于连接微控制器及其外围设备。它是由数据线SDA和时钟SCL构成的串行总线，可发送和接收数据。在CPU与被控IC之间、IC与IC之间进行双向传送，高速IIC总线一般可达<strong>400kbps</strong>。</p><p>IIC是<strong>半双工</strong>通信方式。SDA 和 SCL 都是双向的；数据可以在主设备和从设备之间来回传送。主设备启动总线上的所有数据传输，并生成所有时钟信号。在开始传输数据之前，主设备必须先寻址一个特定的从设备并接收一条确认信息。</p><h1 id="协议层"><a href="#协议层" class="headerlink" title="协议层"></a>协议层</h1><p>每个I2C数据操作都由以下元素组成：启动（或重复启动）、寻址、数据和停止。</p><p><strong>启动或重复启动</strong></p><p>主设备控制时钟线路，因此它启动总线上的所有通信。要控制总线并启动数据传输，主设备会首先发送一个启动条件。 启动条件向总线上的所有器件发送信号，通知主设备已经控制了总线，并将发送一个地址。此时，总线即被视为繁忙，其他主设备必须等待停止条件使总线恢复空闲状态后，才能启动数据传输。 启动 &#x3D; SCL 为高电平时，SDA 从高电平转变为低电平。重复启动条件在物理层面上与启动条件相同。它表示主设备已经维持对总线的控制而且该总线没有处于闲置状态。</p><p><strong>地址</strong></p><p>主设备发出启动条件后，发送的第一个数据字节就是地址。每个从设备都有唯一的地址。大多数I2C地址的长度都为七个数据位。读&#x2F;写（R&#x2F;W）位凑满8位字节并指出接下来数据传输的通信方向。“读”代表主设备希望从设备中读取数据。“写”表明主设备希望向从设备中写入数据。<strong>所有地址和数据字节都优先发送最高有效位 （MSB）。</strong></p><p><strong>ACK&#x2F;NAK</strong></p><p>主设备发送地址后，等待从设备发出确认（ACK）信息。ACK是一个附加的状态位，位于每个数据字节的末尾，因此，所有I2C数据传输的长度都是九位。总线上所有从设备都要读取接收到的地址，并将其与自己的内部地址进行比较。如果地址相匹配，从设备必须在第九个时钟循环发出ACK信息。如果地址不相匹配，从设备将不响应（发出NAK信息）。ACK &#x3D; 0（低逻辑电平）NAK &#x3D; 1（高逻辑电平）</p><p><strong>数据</strong></p><p>主设备发送地址而且从设备确认后，每次可以传送八位数据。主设备和从设备都可以传送和接收，因此它们一起拥有SDA线的控制权。SDA线上的数据在SCL的上升沿前必须保持稳定状态。仅当SCL为低电平时，才能更改SDA上的数据。</p><img src="https://raw.githubusercontent.com/xianren-WRD/Picture/main/img/20201116192841.png" alt="image-20200823132727777" style="zoom:80%"><p>主设备执行写入操作时，在SDA上写出八位的数据，并在SCL上提供八个时钟周期。主设备发送八位数据后，从设备负责在第九个时钟周期发送ACK或者NAK信号；请参考图7。</p><img src="https://raw.githubusercontent.com/xianren-WRD/Picture/main/img/20201116192846.png" alt="image-20200823133148069" style="zoom:67%"><ul><li><p>ACK &#x3D; 从设备有足够空间容纳更多数据。</p></li><li><p>NAK &#x3D; 从设备无法容纳更多数据</p></li></ul><p>交替条件表明主设备希望在从设备中读取数据。在这种情况下，主设备会提供八个时钟周期，但是从设备在SDA上传输八个数据位。传输八个数据位后，主设备必须发送ACK或NAK信号。</p><ul><li>ACK &#x3D; 主设备希望读取更多数据。</li><li>NAK &#x3D; 主设备读取完毕。</li></ul><p>注意：从设备无法通知主设备没有要发送的数据。</p><p><strong>停止</strong></p><p>发送所有字节后，主设备要发送一个停止条件。停止条件表明当前数据传输已完成，总线处于闲置状态；停止 &#x3D; SCL为高电平时，SDA从低电平转变至高电平。</p><p>除了发送停止条件之外，主设备还可以发送重复启动条件。重复启动条件在物理层面上与启动条件相同。当主设备想要通知从设备开始新的数据传输或者更改数据流的方向时，主设备会发送重复启动条件，这样可以保持对总线的控制。当主设备想要向特定的从设备写入数据，然后反过来从该从设备中读取数据时，需要使用重复启动条件。通过使用重复启动条件，主设备可以维持对总线的控制。如果使用停止条件，则总线可能由其他主设备控制。</p><p><strong>仲裁</strong></p><p>I2C协议允许多个主设备在同一总线上进行通信。两个主设备可以同时进行通信。为了防止数据丢失，每个I2C主设备都必须查看I2C总线，确保总线上的数据为自己所提供。如果数据不匹配，仲裁失败的I2C主设备必须停止驱动SDA线，并等待总线闲置后再重新尝试发送数据。如图10所示，当一个主设备将SDA保持为高电平，而另一个主设备尝试将SDA驱动至低电平时，前者仲裁失败，必须等待。</p><img src="https://raw.githubusercontent.com/xianren-WRD/Picture/main/img/20201116192853.png" alt="image-20200823134806106" style="zoom:67%"> <img src="https://raw.githubusercontent.com/xianren-WRD/Picture/main/img/20201116192859.png" alt="image-20200822160653691" style="zoom:67%"><p><strong>I2C通信原理-I2C协议</strong></p><ul><li><p>空闲状态</p><p>I2C总线总线的SDA和SCL两条信号线同时处于高电平时，规定为总线的空闲状态。此时各个器件的输出级场效应管均处在截止状态，即释放总线，由两条信号线各自的上拉电阻把电平拉高。</p><img src="https://raw.githubusercontent.com/xianren-WRD/Picture/main/img/20201116192906.png" alt="image-20200822161555286" style="zoom:67%"></li><li><p>开始信号</p><p>当SCL为高期间，SDA由高到低的跳变；启动信号是一种电平跳变时序信号，而不是一个电平信号。</p><img src="https://raw.githubusercontent.com/xianren-WRD/Picture/main/img/20201116192911.png" alt="image-20200822161710522" style="zoom:67%"></li><li><p>停止信号</p><p>当SCL为高期间，SDA由低到高的跳变；停止信号也是一种电平跳变时序信号，而不是一个电平信号。</p><img src="https://raw.githubusercontent.com/xianren-WRD/Picture/main/img/20201116192916.png" alt="image-20200822161737129" style="zoom:67%"></li><li><p>应答信号</p><p>发送器每发送一个字节，就在时钟脉冲9期间释放数据线，由接收器反馈一个应答信号。应答信号为低电平时，规定为有效应答位（ACK简称应答位），表示接收器已经成功地接收了该字节；应答信号为高电平时，规定为非应答位（NACK），一般表示接收器接收该字节没有成功。</p><p>对于反馈有效应答位ACK的要求是，接收器在第9个时钟脉冲之前的低电平期间将SDA线拉低，并且确保在该时钟的高电平期间为稳定的低电平。 如果接收器是主控器，则在它收到最后一个字节后，发送一个NACK信号，以通知被控发送器结束数据发送，并释放SDA线，以便主控接收器发送一个停止信号P。</p><p>释放数据线：<a target="_blank" rel="noopener" href="https://www.cnblogs.com/CodeWorkerLiMing/p/10830778.html">https://www.cnblogs.com/CodeWorkerLiMing/p/10830778.html</a></p></li><li><p>数据的有效性</p><p>I2C总线进行数据传送时，时钟信号为高电平期间，数据线上的数据必须保持稳定，只有在时钟线上的信号为低电平期间，数据线上的高电平或低电平状态才允许变化。即：数据在SCL的上升沿到来之前就需准备好。并在在下降沿到来之前必须稳定。</p><img src="https://raw.githubusercontent.com/xianren-WRD/Picture/main/img/20201116192927.png" alt="image-20200822162533199" style="zoom:67%"></li><li><p>数据传输</p><p>在I2C总线上传送的每一位数据都有一个时钟脉冲相对应（或同步控制），即在SCL串行时钟的配合下，在SDA上逐位地串行传送每一位数据。数据位的传输是边沿触发。</p></li></ul><p>ACK总结：</p><ul><li>规定如果是发送一个字节，必须接受一个应答信号；同理，接受一个字节，必定发送一个应答信号。</li><li>规定应答信号：低电平是有效应答（也就是正常接受了一个字节数据），高电平为无效应答，也称为非应答（也就是接受字节异常，或者是用于结束接受）</li></ul><p><strong>模拟IIC</strong></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">引脚说明：(可以是任意两个引脚)</span></span><br><span class="line"><span class="comment">PB8 -- SCL</span></span><br><span class="line"><span class="comment">PB9 -- SDA</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">Iic_Init</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    GPIO_InitTypeDef  GPIO_InitStruct;</span><br><span class="line">    RCC_AHB1PeriphClockCmd(RCC_AHB1Periph_GPIOB, ENABLE);</span><br><span class="line"></span><br><span class="line">    GPIO_InitStruct.GPIO_Pin    = GPIO_Pin_8|GPIO_Pin_9;        <span class="comment">//引脚8 9</span></span><br><span class="line">    GPIO_InitStruct.GPIO_Mode    = GPIO_Mode_OUT;    <span class="comment">//输出模式</span></span><br><span class="line">    GPIO_InitStruct.GPIO_OType    = GPIO_OType_PP;    <span class="comment">//推挽</span></span><br><span class="line">    GPIO_InitStruct.GPIO_Speed    = GPIO_Speed_50MHz; <span class="comment">//快速</span></span><br><span class="line">    GPIO_InitStruct.GPIO_PuPd    = GPIO_PuPd_UP;     <span class="comment">//上拉</span></span><br><span class="line">    GPIO_Init(GPIOB, &amp;GPIO_InitStruct);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//总线空闲</span></span><br><span class="line">    SCL = <span class="number">1</span>;</span><br><span class="line">    SDA_OUT = <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//切换SDA模式</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">Iic_Sda_Mode</span><span class="params">(GPIOMode_TypeDef Mode)</span></span><br><span class="line">&#123;</span><br><span class="line">    GPIO_InitTypeDef  GPIO_InitStruct;</span><br><span class="line"></span><br><span class="line">    GPIO_InitStruct.GPIO_Pin    = GPIO_Pin_9;        <span class="comment">//引脚9</span></span><br><span class="line">    GPIO_InitStruct.GPIO_Mode    = Mode;    </span><br><span class="line">    GPIO_InitStruct.GPIO_OType    = GPIO_OType_PP;    <span class="comment">//推挽</span></span><br><span class="line">    GPIO_InitStruct.GPIO_Speed    = GPIO_Speed_50MHz; <span class="comment">//快速</span></span><br><span class="line">    GPIO_InitStruct.GPIO_PuPd    = GPIO_PuPd_UP;     <span class="comment">//上拉</span></span><br><span class="line">    GPIO_Init(GPIOB, &amp;GPIO_InitStruct);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//开始信号</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">Iic_Start</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    Iic_Sda_Mode(GPIO_Mode_OUT);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//总线空闲</span></span><br><span class="line">    SCL = <span class="number">1</span>;</span><br><span class="line">    SDA_OUT = <span class="number">1</span>;</span><br><span class="line">    delay_us(<span class="number">5</span>);</span><br><span class="line"></span><br><span class="line">    SDA_OUT = <span class="number">0</span>;</span><br><span class="line">    delay_us(<span class="number">5</span>);</span><br><span class="line">    SCL = <span class="number">0</span>;  <span class="comment">//钳住总线</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//停止信号</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">Iic_Stop</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    Iic_Sda_Mode(GPIO_Mode_OUT);</span><br><span class="line"></span><br><span class="line">    SCL = <span class="number">0</span>;</span><br><span class="line">    SDA_OUT = <span class="number">0</span>;</span><br><span class="line">    delay_us(<span class="number">5</span>);    </span><br><span class="line"></span><br><span class="line">    SCL = <span class="number">1</span>;</span><br><span class="line">    delay_us(<span class="number">5</span>);</span><br><span class="line">    SDA_OUT = <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//发送一位数据 </span></span><br><span class="line"><span class="type">void</span> <span class="title function_">Iic_Send_Ack</span><span class="params">(u8 ack)</span></span><br><span class="line">&#123;</span><br><span class="line">    Iic_Sda_Mode(GPIO_Mode_OUT);</span><br><span class="line"></span><br><span class="line">    SCL = <span class="number">0</span>;</span><br><span class="line">    <span class="comment">//准备数据</span></span><br><span class="line">    <span class="comment">//要发数据1</span></span><br><span class="line">    <span class="keyword">if</span>(ack == <span class="number">1</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        SDA_OUT = <span class="number">1</span>;     <span class="comment">//引脚输1</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//要发数据0</span></span><br><span class="line">    <span class="keyword">if</span>(ack == <span class="number">0</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        SDA_OUT = <span class="number">0</span>;     <span class="comment">//引脚输0</span></span><br><span class="line">    &#125;    </span><br><span class="line"></span><br><span class="line">    delay_us(<span class="number">5</span>);</span><br><span class="line">    SCL = <span class="number">1</span>;</span><br><span class="line">    delay_us(<span class="number">5</span>);<span class="comment">//两个延时5us,则为10us一个脉冲周期</span></span><br><span class="line">    SCL = <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//发一个字节</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">Iic_Send_Byte</span><span class="params">(u8 data)</span></span><br><span class="line">&#123;</span><br><span class="line">    u8 i;</span><br><span class="line"></span><br><span class="line">    Iic_Sda_Mode(GPIO_Mode_OUT);</span><br><span class="line"></span><br><span class="line">    SCL = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span>(i=<span class="number">0</span>; i&lt;<span class="number">8</span>; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">//准备数据 如数据 0x87 1 0 0 0 0 1 1 1 </span></span><br><span class="line">        <span class="keyword">if</span>(data &amp; (<span class="number">1</span>&lt;&lt;(<span class="number">7</span>-i)))  </span><br><span class="line">        &#123;</span><br><span class="line">            SDA_OUT = <span class="number">1</span>;     <span class="comment">//引脚输1</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//要发数据0</span></span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            SDA_OUT = <span class="number">0</span>;     <span class="comment">//引脚输0</span></span><br><span class="line">        &#125;    </span><br><span class="line">        delay_us(<span class="number">5</span>);</span><br><span class="line">        SCL = <span class="number">1</span>;</span><br><span class="line">        delay_us(<span class="number">5</span>);</span><br><span class="line">        SCL = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//接受一位数据</span></span><br><span class="line">u8 <span class="title function_">Iic_Recv_Ack</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    u8 ack = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    Iic_Sda_Mode(GPIO_Mode_IN);<span class="comment">//模式设置为输入。这里就相当于释放了数据线</span></span><br><span class="line"></span><br><span class="line">    SCL = <span class="number">0</span>;</span><br><span class="line">    delay_us(<span class="number">5</span>);</span><br><span class="line">    SCL = <span class="number">1</span>;</span><br><span class="line">    delay_us(<span class="number">5</span>);</span><br><span class="line">    <span class="keyword">if</span>(SDA_IN == <span class="number">1</span>) <span class="comment">//判断引脚电平是否为高电平</span></span><br><span class="line">    &#123;</span><br><span class="line">        ack = <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(SDA_IN == <span class="number">0</span>) <span class="comment">//判断引脚电平是否为低电平</span></span><br><span class="line">    &#123;</span><br><span class="line">        ack = <span class="number">0</span>;</span><br><span class="line">    &#125;    </span><br><span class="line"></span><br><span class="line">    SCL = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">return</span> ack;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//接受一个字节</span></span><br><span class="line">u8 <span class="title function_">Iic_Recv_Byte</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    u8 i, data = <span class="number">0</span>;  <span class="comment">//0 0 0 0 0 0 0 0</span></span><br><span class="line"></span><br><span class="line">    Iic_Sda_Mode(GPIO_Mode_IN);</span><br><span class="line"></span><br><span class="line">    SCL = <span class="number">0</span>;</span><br><span class="line">    <span class="comment">//循环8次，接受一个字节</span></span><br><span class="line">    <span class="keyword">for</span>(i=<span class="number">0</span>; i&lt;<span class="number">8</span>; i++)</span><br><span class="line">    &#123;    </span><br><span class="line">        delay_us(<span class="number">5</span>);</span><br><span class="line">        SCL = <span class="number">1</span>;</span><br><span class="line">        delay_us(<span class="number">5</span>);</span><br><span class="line">        <span class="keyword">if</span>(SDA_IN == <span class="number">1</span>) <span class="comment">//判断引脚电平是否为高电平</span></span><br><span class="line">        &#123;</span><br><span class="line">            data |= (<span class="number">1</span>&lt;&lt;(<span class="number">7</span>-i));</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        SCL = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> data;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="AT24C02"><a href="#AT24C02" class="headerlink" title="AT24C02"></a>AT24C02</h1><p>AT24C02是一个2K(2048)位串行CMOS E2PROM，内部含有256个8位字节，CATALYST公司的先进CMOS技术实质上减少了器件的功耗。AT24C02有一个8字节页写缓冲器。该器件通过IIC总线接口进行操作，有一个专门的写保护功能。AT24C02的存储容量为2K bit，内容分成32页，每页8Byte，共256Byte，操作时有两种寻址方式：芯片寻址和片内子地址寻址。</p><ol><li>芯片寻址：AT24C02的芯片地址为1010，其地址控制字格式为1010A2A1A0R&#x2F;W。其中A2，A1，A0可编程地址选择位。A2，A1，A0引脚接高、低电平后得到确定的三位编码，与1010形成7位编码，即为该器件的地址码。R&#x2F;W为芯片读写控制位，该位为0，表示芯片进行写操作。</li><li>片内子地址寻址：芯片寻址可对内部256B中的任一个进行读&#x2F;写操作，其寻址范围为00~FF，共256个寻址单位。</li></ol><p><strong>电路原理图</strong></p><img src="https://raw.githubusercontent.com/xianren-WRD/Picture/main/img/20201116192943.png" alt="image-20200822161519605" style="zoom:67%"><p><strong>24C02简介</strong></p><ul><li><p>24C02是一个2K位串行CMOS 的EEPROM，内部含有256个8位字节。</p></li><li><p>与 400KHz I2C 总线兼容</p></li><li><p>1.8 到 6.0 伏工作电压范围</p></li><li><p>低功耗 CMOS 技术</p></li><li><p>写保护功能 当 WP 为高电平时进入写保护状态</p></li><li><p>页写缓冲器</p></li><li><p>自定时擦写周期</p></li><li><p>1,000,000 编程&#x2F;擦除周期</p></li><li><p>可保存数据 100 年</p></li></ul><ol><li><p>AT24C02地址意义</p><img src="https://raw.githubusercontent.com/xianren-WRD/Picture/main/img/20201116192948.png" alt="image-20200822163957453" style="zoom:80%"> <img src="https://raw.githubusercontent.com/xianren-WRD/Picture/main/img/20201116192954.png" alt="image-20200822164038218" style="zoom:80%"><p>高四位1010是24Cxx系列的固定器件地址，接下来是A2、A1、A0是根据器件连接来决定，我们的原理图都接地所以是000。R&#x2F;W为是选择读还是写，1的时候是读，0的时候是写。所以写的地址为0xA0。</p></li><li><p>写时序</p><img src="https://raw.githubusercontent.com/xianren-WRD/Picture/main/img/20201116193002.png" alt="image-20200822164301888" style="zoom:80%"> <img src="https://raw.githubusercontent.com/xianren-WRD/Picture/main/img/20201116193007.png" alt="image-20200822164829219" style="zoom:80%"></li><li><p>读时序</p><img src="https://raw.githubusercontent.com/xianren-WRD/Picture/main/img/20201116193012.png" alt="image-20200822165654054" style="zoom:67%"></li></ol><p>示例代码</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//使用前面所述的模拟IIC</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">AT24C02_Write</span><span class="params">(u8 addr, u8 *write_buf, u8 len)</span></span><br><span class="line">&#123;</span><br><span class="line">    u8 ack;</span><br><span class="line">    <span class="comment">//开始信号</span></span><br><span class="line">    Iic_Start();</span><br><span class="line"></span><br><span class="line">    <span class="comment">//发送设备地址，并执行写操作</span></span><br><span class="line">    Iic_Send_Byte(<span class="number">0xA0</span>);</span><br><span class="line">    ack = Iic_Recv_Ack();</span><br><span class="line">    <span class="keyword">if</span>(ack == <span class="number">1</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;ack failure\n&quot;</span>);</span><br><span class="line">        Iic_Stop();</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//发送写数据的起始地址</span></span><br><span class="line">    Iic_Send_Byte(addr);</span><br><span class="line">    ack = Iic_Recv_Ack();</span><br><span class="line">    <span class="keyword">if</span>(ack == <span class="number">1</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;ack failure\n&quot;</span>);</span><br><span class="line">        Iic_Stop();</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;    </span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span>(len--)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">//发送数据</span></span><br><span class="line">        Iic_Send_Byte(*write_buf);</span><br><span class="line">        ack = Iic_Recv_Ack();</span><br><span class="line">        <span class="keyword">if</span>(ack == <span class="number">1</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;ack failure\n&quot;</span>);</span><br><span class="line">            Iic_Stop();</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//地址加1</span></span><br><span class="line">        write_buf++;    </span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    Iic_Stop();</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;write finish\n&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">AT24C02_Read</span><span class="params">(u8 addr, u8 *read_buf, u8 len)</span></span><br><span class="line">&#123;</span><br><span class="line">    u8 ack;</span><br><span class="line">    <span class="comment">//开始信号</span></span><br><span class="line">    Iic_Start();</span><br><span class="line">    <span class="comment">//发送设置地址，并执行写操作</span></span><br><span class="line">    Iic_Send_Byte(<span class="number">0xA0</span>);</span><br><span class="line">    ack = Iic_Recv_Ack();</span><br><span class="line">    <span class="keyword">if</span>(ack == <span class="number">1</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;ack failure\n&quot;</span>);</span><br><span class="line">        Iic_Stop();</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//发送读数据的起始地址</span></span><br><span class="line">    Iic_Send_Byte(addr);</span><br><span class="line">    ack = Iic_Recv_Ack();</span><br><span class="line">    <span class="keyword">if</span>(ack == <span class="number">1</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;ack failure\n&quot;</span>);</span><br><span class="line">        Iic_Stop();</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;        </span><br><span class="line">    <span class="comment">//开始信号</span></span><br><span class="line">    Iic_Start();<span class="comment">//重复启动条件。可能是启动条件后面发送的第一个字节一定是地址吧，不然就当普通数据处理了。</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//发送设备地址，并执行读操作</span></span><br><span class="line">    Iic_Send_Byte(<span class="number">0xA1</span>);</span><br><span class="line">    ack = Iic_Recv_Ack();</span><br><span class="line">    <span class="keyword">if</span>(ack == <span class="number">1</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;ack failure\n&quot;</span>);</span><br><span class="line">        Iic_Stop();</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;    </span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span>(len--)  <span class="comment">//len = 5</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// len 4 3 2 1 0</span></span><br><span class="line">        <span class="comment">//接受数据</span></span><br><span class="line">        *read_buf = Iic_Recv_Byte();</span><br><span class="line">        <span class="comment">//地址加1</span></span><br><span class="line">        read_buf++;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(len &gt; <span class="number">0</span>)</span><br><span class="line">            Iic_Send_Ack(<span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//发送非应答</span></span><br><span class="line">    Iic_Send_Ack(<span class="number">1</span>);    </span><br><span class="line">    Iic_Stop();</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;read finish\n&quot;</span>);    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="OLED"><a href="#OLED" class="headerlink" title="OLED"></a>OLED</h1><p>取模软件的设置参考</p><p><img src="https://raw.githubusercontent.com/xianren-WRD/Picture/main/img/20201129213444.png" alt="image-20201122202115798"></p><p><strong>硬件连接图</strong></p><img src="https://raw.githubusercontent.com/xianren-WRD/Picture/main/img/20201116193019.png" alt="image-20200822172430274" style="zoom:67%"> <img src="https://raw.githubusercontent.com/xianren-WRD/Picture/main/img/20201116193027.png" alt="image-20200822172541989" style="zoom:67%"><p>OLED本身是没有显存的，它的显存是依赖于SSD1306（驱动芯片）提供的，ssd1306本身是不带字库的，只能通过绘图扫描的方式来进行显示。SSD1306的显存<strong>GDDRAM在串行模式下不提供数据读</strong>，总共为128 * 64bit大小，SSD1306将这些显存分为了8页。每页包含了128个字节，总共8页，这样刚好是128*64的点阵大小。不提供数据读，但是我们可以构建一个虚拟缓存<code>unsigned char GDDRAM[8][128]</code>，每次向SSD1306的显存中更新这个数组的值，而在程序中就只需要对数组做操作。<a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_42415539/article/details/85212043">https://blog.csdn.net/weixin_42415539/article/details/85212043</a></p><img src="https://raw.githubusercontent.com/xianren-WRD/Picture/main/img/20201116193035.png" alt="image-20200914232207021" style="zoom:67%"> <img src="https://raw.githubusercontent.com/xianren-WRD/Picture/main/img/20201116193040.png" alt="image-20200914233057167" style="zoom:67%"><p>内存地址模式一共有三种：页地址模式，水平地址模式和垂直地址模式，需要使用命令将地址模式设置为以上三种之一。</p><ul><li><p>页地址模式(A[1:0]&#x3D;10b)<br>当处于此模式时，在GDDRAM访问后(读&#x2F;写)，列地址指针将自动增加1。如果列地址指针到达列终止地址，列地址指针将复位到列起始地址，但页地址指针不会改变。为了访问GDDRAM中下一页的内容，用户必须设置新的页地址和列地址。通常在页地址模式下访问GDDRAM, 需要如下步骤来定义起始RAM访问指针指向:</p><ul><li>通过命令(B0h-B7h)设置目标显示位置页起始地址</li><li>通过命令(00h-0Fh)设置列起始地址低位</li><li>通过命令(10h-1Fh)设置列起始地址高位（移植的源码经过测试只用了三位）</li></ul><p>如果页地址是B2h, 列地址低位是03h, 列地址高位是10h, 起始列将为PAGE2的SEG3。</p><img src="https://raw.githubusercontent.com/xianren-WRD/Picture/main/img/20201129213806.png" alt="image-20201129213806741" style="zoom:67%"></li><li><p>水平地址模式(A[1:0]&#x3D;00b)<br>当处于此模式时, 在GDDRAM访问后(读&#x2F;写), 列地址指针将自动增加1。如果列地址指针到达列终止地址, 列地址指针将复位到列起始地址, 且页地址指针将自动增加1。水平地址模式下页以及列地址指针的行为如下图所示, 如果列地址指针和页地址指针都到达各自的终止地址时, 他们都将复位到各自的起始地址。(图中虚线)</p><img src="https://raw.githubusercontent.com/xianren-WRD/Picture/main/img/20201116193052.png" alt="image-20200914180435644" style="zoom:67%"></li><li><p>垂直地址模式(A[1:0]&#x3D;01b)<br>当处于此模式时, 在GDDRAM访问后(读&#x2F;写), 页地址指针将自动增加1。如果页地址指针到达页终止地址, 页地址指针将复位到页起始地址, 且列地址指针将自动增加1。垂直地址模式下页以及列地址指针的行为如下图所示, 如果列地址指针和页地址指针都到达各自的终止地址时, 他们都将复位到各自的起始地址。(图中虚线)</p><img src="https://raw.githubusercontent.com/xianren-WRD/Picture/main/img/20201116193058.png" alt="image-20200914180516635" style="zoom:67%"></li></ul><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1.</span>使用移植核心文件中的代码（路径：D:\STM32\<span class="number">09</span>\移植核心文件），移植程序</span><br><span class="line">DelayInit();修改为STM32平台Delay_Init();</span><br><span class="line">I2C_Configuration();里面的初始化修改为模拟IIC初始化（PE8 PE10）</span><br><span class="line">OLED_Init();函数里面的延时函数修改为STM32F407的延时函数</span><br><span class="line"></span><br><span class="line"><span class="number">2.</span>修改函数</span><br><span class="line"><span class="type">void</span> <span class="title function_">I2C_WriteByte</span><span class="params">(<span class="type">uint8_t</span> addr,<span class="type">uint8_t</span> data)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">//启动信号</span></span><br><span class="line">    I2C_GenerateSTART(I2C1, ENABLE);<span class="comment">//开启I2C1</span></span><br><span class="line">    <span class="keyword">while</span>(!I2C_CheckEvent(I2C1, I2C_EVENT_MASTER_MODE_SELECT));<span class="comment">/*EV5,主模式*/</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//发送设备地址（一个字节）</span></span><br><span class="line">    I2C_Send7bitAddress(I2C1, OLED_ADDRESS, I2C_Direction_Transmitter);<span class="comment">//器件地址 -- 默认0x78</span></span><br><span class="line">    <span class="comment">//等待应答</span></span><br><span class="line">    <span class="keyword">while</span>(!I2C_CheckEvent(I2C1, I2C_EVENT_MASTER_TRANSMITTER_MODE_SELECTED));</span><br><span class="line"></span><br><span class="line">    <span class="comment">//发送寄存器地址（一个字节）</span></span><br><span class="line">    I2C_SendData(I2C1, addr);<span class="comment">//寄存器地址</span></span><br><span class="line">    <span class="comment">//等待应答</span></span><br><span class="line">    <span class="keyword">while</span> (!I2C_CheckEvent(I2C1, I2C_EVENT_MASTER_BYTE_TRANSMITTED));</span><br><span class="line"></span><br><span class="line">    <span class="comment">//发送数据（一个字节）</span></span><br><span class="line">    I2C_SendData(I2C1, data);<span class="comment">//发送数据</span></span><br><span class="line">    <span class="comment">//等待应答</span></span><br><span class="line">    <span class="keyword">while</span> (!I2C_CheckEvent(I2C1, I2C_EVENT_MASTER_BYTE_TRANSMITTED));</span><br><span class="line">    <span class="comment">//停止信号</span></span><br><span class="line">    I2C_GenerateSTOP(I2C1, ENABLE);<span class="comment">//关闭I2C1总线</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="number">3.</span>修改主函数当中的延时函数，修改相关头文件</span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;stm32f10x.h&quot;</span>头文件修改为 #<span class="keyword">include</span> <span class="string">&quot;stm32f4xx.h&quot;</span></span></span><br><span class="line"></span><br><span class="line">WriteCmd(<span class="number">0xAE</span>); <span class="comment">//关闭显示 休眠</span></span><br><span class="line">WriteCmd(<span class="number">0x20</span>);    <span class="comment">//设置内存寻址模式    </span></span><br><span class="line">WriteCmd(<span class="number">0x10</span>);    <span class="comment">//00，水平寻址模式；01，垂直寻址模式；10，页面寻址模式（复位）；11，无效</span></span><br><span class="line"></span><br><span class="line">WriteCmd(<span class="number">0xb0</span>);    <span class="comment">//为页面寻址模式设置页面起始地址，0-7</span></span><br><span class="line">WriteCmd(<span class="number">0xc8</span>);    <span class="comment">//设置COM输出扫描方向。此指令用于设置列输出的扫描方向, 增强了OLED模块设计的布局的伸缩性。</span></span><br><span class="line">                <span class="comment">//注意, 此指令会立即生效。例如当屏幕正常显示时调用此指令, 屏幕将会立刻垂直翻转。</span></span><br><span class="line">WriteCmd(<span class="number">0x00</span>); <span class="comment">//设置低位列地址</span></span><br><span class="line">WriteCmd(<span class="number">0x10</span>); <span class="comment">//设置高位列地址</span></span><br><span class="line">WriteCmd(<span class="number">0x40</span>); <span class="comment">//设置起始行地址</span></span><br><span class="line"></span><br><span class="line">WriteCmd(<span class="number">0x81</span>); <span class="comment">//设置对比度控制寄存器</span></span><br><span class="line">WriteCmd(<span class="number">0xff</span>); <span class="comment">//亮度调节 0x00~0xff</span></span><br><span class="line"></span><br><span class="line">WriteCmd(<span class="number">0xa1</span>); <span class="comment">//--set segment re-map 0 to 127    设置段重映射</span></span><br><span class="line">               <span class="comment">//此指令用于改变屏幕数据列地址和段驱动器间的映射关系, 这增强和OLED模块设计的可伸缩性。此命令只影响其后的数据输入, 已存储在                  GDDRAM中的数据将保持不变。</span></span><br><span class="line">WriteCmd(<span class="number">0xa6</span>); <span class="comment">//设置正常显示</span></span><br><span class="line">WriteCmd(<span class="number">0xa8</span>); <span class="comment">//设置多路复用比率（1到64）</span></span><br><span class="line">WriteCmd(<span class="number">0x3F</span>); <span class="comment">//</span></span><br><span class="line"></span><br><span class="line">WriteCmd(<span class="number">0xa4</span>); <span class="comment">//0xa4，输出跟随RAM内容；0xa5，输出忽略RAM内容。命令A4h启用输出GDDRAM中的数据。如果命令A5h已被调用, 通过A4h指令, 可以将屏                    幕显示从全屏点亮状态中恢复。命令A5h通过忽略GDDRAM中的数据以点亮全屏</span></span><br><span class="line"></span><br><span class="line">WriteCmd(<span class="number">0xd3</span>); <span class="comment">//设置显示偏移</span></span><br><span class="line">WriteCmd(<span class="number">0x00</span>); <span class="comment">//不偏移</span></span><br><span class="line"></span><br><span class="line">WriteCmd(<span class="number">0xd5</span>); <span class="comment">//设置显示时钟分频比/振荡器频率</span></span><br><span class="line">WriteCmd(<span class="number">0xf0</span>); <span class="comment">//设置分割比</span></span><br><span class="line"></span><br><span class="line">WriteCmd(<span class="number">0xd9</span>); <span class="comment">//设置预充电周期</span></span><br><span class="line">WriteCmd(<span class="number">0x22</span>); <span class="comment">//</span></span><br><span class="line"></span><br><span class="line">WriteCmd(<span class="number">0xda</span>); <span class="comment">//设置com引脚硬件配置</span></span><br><span class="line">WriteCmd(<span class="number">0x12</span>);</span><br><span class="line"></span><br><span class="line">WriteCmd(<span class="number">0xdb</span>); <span class="comment">//set vcomh。设置VCOMH反压值</span></span><br><span class="line">WriteCmd(<span class="number">0x20</span>); <span class="comment">//0x20,0.77xVcc</span></span><br><span class="line"></span><br><span class="line">WriteCmd(<span class="number">0x8d</span>); <span class="comment">//设置DC-DC启用，设置电荷泵</span></span><br><span class="line">WriteCmd(<span class="number">0x14</span>); <span class="comment">//0x14开启电荷泵 0x10 关闭电荷泵</span></span><br><span class="line"></span><br><span class="line">WriteCmd(<span class="number">0xaf</span>); <span class="comment">//打开oled面板 OLED唤醒</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//示例代码</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">OLED_SetPos</span><span class="params">(<span class="type">unsigned</span> <span class="type">char</span> x, <span class="type">unsigned</span> <span class="type">char</span> y)</span> <span class="comment">//设置起始点坐标</span></span><br><span class="line">&#123; </span><br><span class="line">    WriteCmd(<span class="number">0xb0</span>+y);<span class="comment">//相当于设置从哪一行开始</span></span><br><span class="line">    <span class="comment">//设置从哪一列开始</span></span><br><span class="line">    WriteCmd(((x&amp;<span class="number">0xf0</span>)&gt;&gt;<span class="number">4</span>)|<span class="number">0x10</span>);<span class="comment">//设置列起始地址高位</span></span><br><span class="line">    WriteCmd((x&amp;<span class="number">0x0f</span>)|<span class="number">0x01</span>);<span class="comment">//设置列起始地址低位</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">OLED_Fill</span><span class="params">(<span class="type">unsigned</span> <span class="type">char</span> fill_Data)</span><span class="comment">//全屏填充</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">unsigned</span> <span class="type">char</span> m,n;</span><br><span class="line">    <span class="keyword">for</span>(m=<span class="number">0</span>;m&lt;<span class="number">8</span>;m++)</span><br><span class="line">    &#123;</span><br><span class="line">        WriteCmd(<span class="number">0xb0</span>+m);    <span class="comment">//page0-page1</span></span><br><span class="line">        WriteCmd(<span class="number">0x00</span>);        <span class="comment">//low column start address</span></span><br><span class="line">        WriteCmd(<span class="number">0x10</span>);        <span class="comment">//high column start address</span></span><br><span class="line">        <span class="keyword">for</span>(n=<span class="number">0</span>;n&lt;<span class="number">128</span>;n++)</span><br><span class="line">        &#123;</span><br><span class="line">            WriteDat(fill_Data);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Parameters     : x,y -- 起始点坐标(x:0~127, y:0~7); ch[] -- 要显示的字符串; TextSize -- 字符大小(1:6*8 ; 2:8*16)</span></span><br><span class="line"><span class="comment">// Description    : 显示codetab.h中的ASCII字符,有6*8和8*16可选择</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">OLED_ShowStr</span><span class="params">(<span class="type">unsigned</span> <span class="type">char</span> x, <span class="type">unsigned</span> <span class="type">char</span> y, <span class="type">unsigned</span> <span class="type">char</span> ch[], <span class="type">unsigned</span> <span class="type">char</span> TextSize)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">unsigned</span> <span class="type">char</span> c = <span class="number">0</span>,i = <span class="number">0</span>,j = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">switch</span>(TextSize)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">1</span>:</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">while</span>(ch[j] != <span class="string">&#x27;\0&#x27;</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                c = ch[j] - <span class="number">32</span>;<span class="comment">//ascii码值-32 算出对应的索引</span></span><br><span class="line">                <span class="keyword">if</span>(x &gt; <span class="number">126</span>)</span><br><span class="line">                &#123;</span><br><span class="line">                    x = <span class="number">0</span>;</span><br><span class="line">                    y++;</span><br><span class="line">                &#125;</span><br><span class="line">                OLED_SetPos(x,y);</span><br><span class="line">                <span class="keyword">for</span>(i=<span class="number">0</span>;i&lt;<span class="number">6</span>;i++)</span><br><span class="line">                    WriteDat(F6x8[c][i]);</span><br><span class="line">                x += <span class="number">6</span>;</span><br><span class="line">                j++;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;<span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">2</span>:</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">while</span>(ch[j] != <span class="string">&#x27;\0&#x27;</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                c = ch[j] - <span class="number">32</span>;</span><br><span class="line">                <span class="keyword">if</span>(x &gt; <span class="number">120</span>)</span><br><span class="line">                &#123;</span><br><span class="line">                    x = <span class="number">0</span>;</span><br><span class="line">                    y++;</span><br><span class="line">                &#125;</span><br><span class="line">                OLED_SetPos(x,y);</span><br><span class="line">                <span class="keyword">for</span>(i=<span class="number">0</span>;i&lt;<span class="number">8</span>;i++)</span><br><span class="line">                    WriteDat(F8X16[c*<span class="number">16</span>+i]);</span><br><span class="line">                OLED_SetPos(x,y+<span class="number">1</span>);</span><br><span class="line">                <span class="keyword">for</span>(i=<span class="number">0</span>;i&lt;<span class="number">8</span>;i++)</span><br><span class="line">                    WriteDat(F8X16[c*<span class="number">16</span>+i+<span class="number">8</span>]);</span><br><span class="line">                x += <span class="number">8</span>;</span><br><span class="line">                j++;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;<span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Parameters     : x,y -- 起始点坐标(x:0~127, y:0~7); N:汉字在codetab.h中的索引</span></span><br><span class="line"><span class="comment">// Description    : 显示codetab.h中的汉字,16*16点阵</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">OLED_ShowCN</span><span class="params">(<span class="type">unsigned</span> <span class="type">char</span> x, <span class="type">unsigned</span> <span class="type">char</span> y, <span class="type">unsigned</span> <span class="type">char</span> N)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">unsigned</span> <span class="type">char</span> wm=<span class="number">0</span>;</span><br><span class="line">    <span class="type">unsigned</span> <span class="type">int</span>  adder=<span class="number">32</span>*N;</span><br><span class="line">    OLED_SetPos(x , y);</span><br><span class="line">    <span class="keyword">for</span>(wm = <span class="number">0</span>;wm &lt; <span class="number">16</span>;wm++)</span><br><span class="line">    &#123;</span><br><span class="line">        WriteDat(F16x16[adder]);</span><br><span class="line">        adder += <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    OLED_SetPos(x,y + <span class="number">1</span>);</span><br><span class="line">    <span class="keyword">for</span>(wm = <span class="number">0</span>;wm &lt; <span class="number">16</span>;wm++)</span><br><span class="line">    &#123;</span><br><span class="line">        WriteDat(F16x16[adder]);</span><br><span class="line">        adder += <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Parameters     : x0,y0 -- 起始点坐标(x0:0~127, y0:0~7); x1,y1 -- 起点对角线(结束点)的坐标(x1:1~128,y1:1~8)</span></span><br><span class="line"><span class="comment">// Description    : 显示BMP位图</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">OLED_DrawBMP</span><span class="params">(<span class="type">unsigned</span> <span class="type">char</span> x0,<span class="type">unsigned</span> <span class="type">char</span> y0,<span class="type">unsigned</span> <span class="type">char</span> x1,<span class="type">unsigned</span> <span class="type">char</span> y1,<span class="type">unsigned</span> <span class="type">char</span> BMP[])</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">unsigned</span> <span class="type">int</span> j=<span class="number">0</span>;</span><br><span class="line">    <span class="type">unsigned</span> <span class="type">char</span> x,y;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(y1%<span class="number">8</span>==<span class="number">0</span>)</span><br><span class="line">        y = y1/<span class="number">8</span>;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        y = y1/<span class="number">8</span> + <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span>(y=y0;y&lt;y1;y++)</span><br><span class="line">    &#123;</span><br><span class="line">        OLED_SetPos(x0,y);</span><br><span class="line">        <span class="keyword">for</span>(x=x0;x&lt;x1;x++)</span><br><span class="line">        &#123;</span><br><span class="line">            WriteDat(BMP[j++]);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><div id="reword-out"><div id="reward-btn">打赏</div></div></div><div class="declare"><ul class="post-copyright"><li><i class="ri-copyright-line"></i> <strong>版权声明： </strong>本博客所有文章除特别声明外，著作权归作者所有。转载请注明出处！</li></ul></div><footer class="article-footer"><div class="share-btn"><span class="share-sns share-outer"><i class="ri-share-forward-line"></i> 分享</span><div class="share-wrap"><i class="arrow"></i><div class="share-icons"><a class="weibo share-sns" href="javascript:;" data-type="weibo"><i class="ri-weibo-fill"></i> </a><a class="weixin share-sns wxFab" href="javascript:;" data-type="weixin"><i class="ri-wechat-fill"></i> </a><a class="qq share-sns" href="javascript:;" data-type="qq"><i class="ri-qq-fill"></i> </a><a class="douban share-sns" href="javascript:;" data-type="douban"><i class="ri-douban-line"></i> </a><a class="facebook share-sns" href="javascript:;" data-type="facebook"><i class="ri-facebook-circle-fill"></i> </a><a class="twitter share-sns" href="javascript:;" data-type="twitter"><i class="ri-twitter-fill"></i> </a><a class="google share-sns" href="javascript:;" data-type="google"><i class="ri-google-fill"></i></a></div></div></div><div class="wx-share-modal"><a class="modal-close" href="javascript:;"><i class="ri-close-circle-line"></i></a><p>扫一扫，分享到微信</p><div class="wx-qrcode"><img src="//api.qrserver.com/v1/create-qr-code/?size=150x150&data=https://xianren-wrd.github.io/2025/prefix%20remember%20to%20change!!!-ad3df2fe07bc/" alt="微信分享二维码"></div></div><div id="share-mask"></div><ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/IIC/" rel="tag">IIC</a></li></ul></footer></div><nav class="article-nav"><a href="/2025/prefix%20remember%20to%20change!!!-ab00c8087bd4/" class="article-nav-link"><strong class="article-nav-caption">上一篇</strong><div class="article-nav-title">SPI介绍</div></a><a href="/2025/prefix%20remember%20to%20change!!!-5323449eed0c/" class="article-nav-link"><strong class="article-nav-caption">下一篇</strong><div class="article-nav-title">看门狗扫盲</div></a></nav><script src="https://cdn.staticfile.org/twikoo/1.4.18/twikoo.all.min.js"></script><div id="twikoo" class="twikoo"></div><script>twikoo.init({envId:""})</script></article></section><footer class="footer"><div class="outer"><ul><li>Copyrights &copy; 2021-2025 <i class="ri-heart-fill heart_icon"></i> wrd</li></ul><ul><li></li></ul><ul><li><span><span><i class="ri-user-3-fill"></i>访问人数:<span id="busuanzi_value_site_uv"></span></span> <span class="division">|</span> <span><i class="ri-eye-fill"></i>浏览次数:<span id="busuanzi_value_page_pv"></span></span></span></li></ul><ul></ul><ul></ul><ul><li><script type="text/javascript" src="https://s9.cnzz.com/z_stat.php?id=1278069914&amp;web_id=1278069914"></script></li></ul></div></footer></main><div class="float_btns"><div class="totop" id="totop"><i class="ri-arrow-up-line"></i></div><div class="todark" id="todark"><i class="ri-moon-line"></i></div></div><aside class="sidebar on"><button class="navbar-toggle"></button><nav class="navbar"><div class="logo"><a href="/"><img src="/images/ayer-side.svg" alt="仙人"></a></div><ul class="nav nav-main"><li class="nav-item"><a class="nav-item-link" href="/">主页</a></li><li class="nav-item"><a class="nav-item-link" href="/archives">归档</a></li><li class="nav-item"><a class="nav-item-link" href="/categories">分类</a></li><li class="nav-item"><a class="nav-item-link" href="/tags">标签</a></li></ul></nav><nav class="navbar navbar-bottom"><ul class="nav"><li class="nav-item"><a class="nav-item-link nav-item-search" title="搜索"><i class="ri-search-line"></i> </a><a class="nav-item-link" target="_blank" href="/atom.xml" title="RSS Feed"><i class="ri-rss-line"></i></a></li></ul></nav><div class="search-form-wrap"><div class="local-search local-search-plugin"><input type="search" id="local-search-input" class="local-search-input" placeholder="Search..."><div id="local-search-result" class="local-search-result"></div></div></div></aside><div id="mask"></div><div id="reward"><span class="close"><i class="ri-close-line"></i></span><p class="reward-p"><i class="ri-cup-line"></i>请我喝杯咖啡吧~</p><div class="reward-box"><div class="reward-item"><img class="reward-img" src="/images/alipay.jpg"> <span class="reward-type">支付宝</span></div><div class="reward-item"><img class="reward-img" src="/images/wechat.jpg"> <span class="reward-type">微信</span></div></div></div><script src="/js/jquery-3.6.0.min.js"></script><script src="/js/lazyload.min.js"></script><script src="/js/tocbot.min.js"></script><script>tocbot.init({tocSelector:".tocbot",contentSelector:".article-entry",headingSelector:"h1, h2, h3, h4, h5, h6",hasInnerContainers:!0,scrollSmooth:!0,scrollContainer:"main",positionFixedSelector:".tocbot",positionFixedClass:"is-position-fixed",fixedSidebarOffset:"auto"})</script><script src="https://cdn.staticfile.org/jquery-modal/0.9.2/jquery.modal.min.js"></script><link rel="stylesheet" href="https://cdn.staticfile.org/jquery-modal/0.9.2/jquery.modal.min.css"><script src="https://cdn.staticfile.org/justifiedGallery/3.8.1/js/jquery.justifiedGallery.min.js"></script><script src="/dist/main.js"></script><div class="pswp" tabindex="-1" role="dialog" aria-hidden="true"><div class="pswp__bg"></div><div class="pswp__scroll-wrap"><div class="pswp__container"><div class="pswp__item"></div><div class="pswp__item"></div><div class="pswp__item"></div></div><div class="pswp__ui pswp__ui--hidden"><div class="pswp__top-bar"><div class="pswp__counter"></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button> <button class="pswp__button pswp__button--share" style="display:none" title="Share"></button> <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button> <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class="pswp__preloader"><div class="pswp__preloader__icn"><div class="pswp__preloader__cut"><div class="pswp__preloader__donut"></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class="pswp__share-tooltip"></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)"></button> <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class="pswp__caption"><div class="pswp__caption__center"></div></div></div></div></div><link rel="stylesheet" href="https://cdn.staticfile.org/photoswipe/4.1.3/photoswipe.min.css"><link rel="stylesheet" href="https://cdn.staticfile.org/photoswipe/4.1.3/default-skin/default-skin.min.css"><script src="https://cdn.staticfile.org/photoswipe/4.1.3/photoswipe.min.js"></script><script src="https://cdn.staticfile.org/photoswipe/4.1.3/photoswipe-ui-default.min.js"></script><script>function viewer_init(){let i=document.querySelectorAll(".pswp")[0],r=document.querySelectorAll(".article-entry img:not(.reward-img)");r.forEach((t,e)=>{t.onclick=()=>{if(!document.querySelector(".left-col.show")){let o=[];r.forEach((t,e)=>{t.getAttribute("data-idx",e);var e=t.getAttribute("data-target")||t.getAttribute("src"),i=t.getAttribute("alt"),r=new Image;r.src=e,o.push({src:e,w:r.width||t.width,h:r.height||t.height,title:i})}),new PhotoSwipe(i,PhotoSwipeUI_Default,o,{index:parseInt(e)}).init()}}})}viewer_init()</script><script src="/js/busuanzi-2.3.pure.min.js"></script><script src="/js/clickBoom2.js"></script><link rel="stylesheet" href="/css/clipboard.css"><script src="https://cdn.staticfile.org/clipboard.js/2.0.10/clipboard.min.js"></script><script>function wait(e,i){window.setTimeout(e,i)}!function(){var e;e="",e+='<button class="btn-copy" data-clipboard-snippet=""><i class="ri-file-copy-2-line"></i><span>COPY</span></button>',$(".highlight .code pre").before(e),$(".article pre code").before(e),(e=new ClipboardJS(".btn-copy",{target:function(e){return e.nextElementSibling}})).on("success",function(e){e=$(e.trigger);e.addClass("copied");let i=$(e.find("i")),n=(i.removeClass("ri-file-copy-2-line"),i.addClass("ri-checkbox-circle-line"),$(e.find("span")));n[0].innerText="COPIED",wait(function(){i.removeClass("ri-checkbox-circle-line"),i.addClass("ri-file-copy-2-line"),n[0].innerText="COPY"},2e3)}),e.on("error",function(e){e.clearSelection();e=$(e.trigger);e.addClass("copy-failed");let i=$(e.find("i")),n=(i.removeClass("ri-file-copy-2-line"),i.addClass("ri-time-line"),$(e.find("span")));n[0].innerText="COPY FAILED",wait(function(){i.removeClass("ri-time-line"),i.addClass("ri-file-copy-2-line"),n[0].innerText="COPY"},2e3)})}((window,document))</script><script src="/js/dz.js"></script><script>window.mermaid&&mermaid.initialize({theme:"forest"})</script></div></body>